!function(){"use strict";var a=angular.module("learnApp",["ui.router","learnApp.home","learnApp.login","learnApp.categories","learnApp.documentaries","learnApp.signup","learnApp.news","angular-storage"]);a.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){b.otherwise("/home"),a.state("main",{url:"/",controller:"Apptrl",templateUrl:""})}]),a.run(["$rootScope","$state","store",function(a,b,c){a.$on("$stateChangeStart",function(b,d){d.data&&d.data.requiresLogin&&(c.get("session")||(a.login=!1))}),a.$watch("username",function(b,d){console.log("new value:"+b),console.log("old value:"+d),d||(a.username=c.get("username"))})}]),a.filter("sanitize",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),a.constant("API_URL","http://api.picnicgrafico.com/api"),a.controller("AppCtrl",["$rootScope","$scope","store",function(a,b,c){var d=c.get("session");d&&(console.log("sess: "+d),a.login=!0,a.username=c.get("username")),b.logout=function(){a.login=!1,a.username=void 0,c.remove("username"),c.remove("session_token"),c.remove("session")}}]),a.factory("YouTubeLoader",["$q","$window",function(a,b){var c=document.createElement("script");c.src="http://www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d);var e=!1,f=a.defer();return b.onYouTubeIframeAPIReady=function(){e||(e=!0,f.resolve())},{whenLoaded:function(){return f.promise}}}]),a.directive("youtube",["YouTubeLoader","$compile",function(a,b){return{restrict:"E",scope:{height:"@",width:"@",videoid:"@",type:"@"},template:"<div></div>",link:function(c,d){var e,f,g=document.createElement("script");g.src="http://www.youtube.com/player_api";var h=document.getElementsByTagName("script")[0];h.parentNode.insertBefore(g,h);var i;c.$watch("videoid",function(g,h){console.log(g),console.log(c.type),"youtube"===c.type?a.whenLoaded().then(function(){i=new YT.Player(d.children()[0],{playerVars:{autoplay:0,html5:1,theme:"light",modesbranding:0,color:"white",iv_load_policy:3,showinfo:1,controls:1},height:c.height,width:c.width,videoId:g})}):(console.log("Creating player"),e=angular.element("<span/>"),f='<video class="resp-vid" width="640" height="390" controls><source src="build/assets/video/'+g+"/"+g+'.mp4" type="video/mp4">Your browser does not support the video tag.</video>',e.append(f),b(e)(c),d.append(e))})}}}])}(),function(){"use strict";angular.module("learnApp.home",["ui.router","angular-storage"]).config(["$stateProvider",function(a){a.state("home",{url:"/home",controller:"HomeCtrl",templateUrl:"build/html/home/home.html"})}]).controller("HomeCtrl",function(){})}(),function(){"use strict";angular.module("learnApp.login",["ui.router","angular-storage"]).config(["$stateProvider",function(a){a.state("login",{url:"/login",controller:"LoginCtrl",templateUrl:"build/html/login/login.html"})}]).controller("LoginCtrl",["$scope","$http","store","$state","Login",function(a,b,c,d,e){a.user={},a.login=function(){e.login(a.user).then(function(a){c.set("session","loginCredential"),c.set("session_token",a.data.session_token),c.set("username",a.data.username),d.go("home")},function(a){401===a&&alert("Error en secci√≥n. Debes ingresar tu email y password correspondientes.")})}}]).factory("Login",["API_URL","$q","$http",function(a,b,c){var d;return d=function(d){var e=a+"/user/session";console.log("-- REQUEST --");var f=b.defer();return c({method:"POST",url:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:d}).success(function(a){f.resolve(a)}).error(function(a,b){f.reject(b),console.log(a,b)}),f.promise},{login:d}}])}(),function(){"use strict";angular.module("learnApp.categories",["ui.router","angular-storage"]).config(["$stateProvider",function(a){a.state("categories",{url:"/categories",controller:"CatsCtrl",templateUrl:"build/html/categories/categories.html"}).state("categories.cat",{url:"/:cat",controller:"CatCtrl",templateUrl:"build/html/categories/category_list.html"}).state("categories.resource",{url:"/:cat/:id",controller:"ResCtrl",templateUrl:"build/html/categories/resource.html"})}]).controller("CatsCtrl",["$scope","catsData","store",function(a,b,c){var d=c.get("categories");d?(console.log("loading data from local storage"),a.categories=d,a.loadingIsDone=!0):(console.log("loading data from server"),a.loadingIsDone=!1,b.getCategories().then(function(b){a.categories=b,a.loadingIsDone=!0}))}]).controller("CatCtrl",["$scope","$stateParams","store","catsData",function(a,b,c,d){var e=c.get("categories"),f={};a.loadingIsDone=!1,e.forEach(function(a){f[a.id]={},f[a.id].sectionTitle=a.title,f[a.id].description=a.description}),a.category=b.cat,d.getTopicsByCategory(a.category).then(function(c){var d=c;a.category=b.cat,a.categories=d,a.meta=f[a.category],a.loadingIsDone=!0})}]).controller("ResCtrl",["$rootScope","$scope","$stateParams","catsData","$sce",function(a,b,c,d,e){var f=c.id,g=c.cat;d.getTopicPost(g,f).then(function(c){console.log(c),b.topics=c.topics;var d=[];b.topics.forEach(function(a,c){b.topics[c].content=e.trustAsHtml(a.content),d.push(a.time)}),b.times=d,b.meta=c.meta,a.$broadcast("event:data-received",{type:c.type,video:c.media})})}]).factory("catsData",["API_URL","$q","$http","store",function(a,b,c,d){var e,f,g;return e=function(){return c.get(a+"/categories").then(function(a){var c=[];return"object"==typeof a.data?(d.set("categories",a.data.categories),a.data.categories.forEach(function(a){var b={id:a.id,title:a.title,description:a.description,image:a.image};c.push(b)}),c):b.reject(a.data)},function(a){return b.reject(a.data)})},f=function(e){return c.get(a+"/categories/"+e).then(function(a){return"object"==typeof a.data?(d.set(e+"topics",a.data.topics),a.data.topics):b.reject(a.data)},function(a){return b.reject(a.data)})},g=function(d,e){return c.get(a+"/categories/"+d+"/topic/"+e).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},{getCategories:e,getTopicsByCategory:f,getTopicPost:g}}])}(),function(){"use strict";angular.module("learnApp.documentaries",["ui.router","angular-storage"]).config(["$stateProvider",function(a){a.state("docs",{url:"/documentaries",controller:"DocsCtrl",templateUrl:"build/html/documentaries/documentaries.html"}).state("docs.id",{url:"/:id",controller:"DocCtrl",templateUrl:"build/html/documentaries/documental.html"})}]).controller("DocsCtrl",["$scope","store","docsData",function(a,b,c){var d=b.get("documentaries");a.documentaries=[],d?(console.log("loading data from local storage"),d.forEach(function(b){var c={id:b.id,thumbnail:b.thumbnail,title:b.title,subTitle:b.sub_title,brief:b.brief,time:b.time};a.documentaries.push(c),a.loadingIsDone=!0})):c.getDocumentaries().then(function(b){console.log("loading data from server"),a.documentaries=b,a.loadingIsDone=!0})}]).controller("DocCtrl",["$rootScope","$scope","$stateParams","docsData",function(a,b,c,d){d.getDocumentary(c.id-1).then(function(c){b.doc=c,a.$broadcast("event:data-received",{type:c.type,video:c.videoId}),b.loadingIsDone=!0})}]).factory("docsData",["API_URL","$q","$http","store","$state",function(a,b,c,d,e){var f,g;return f=function(){return c.get(a+"/documentaries").then(function(a){var c=[];return"object"==typeof a.data?(d.set("documentaries",a.data.documentaries),a.data.documentaries.forEach(function(a){var b={id:a.id,thumbnail:a.thumbnail,title:a.title,subTitle:a.sub_title,brief:a.brief,time:a.time};c.push(b)}),c):b.reject(a.data)},function(a){return b.reject(a.data)})},g=function(a){var c,f,g;return c=d.get("documentaries"),f=b.defer(),g=[],c?(c.forEach(function(a){var b={id:a.id,title:a.title,data:a.content,videoId:a.media,type:a.type,time:a.time};g.push(b)}),f.resolve(g[a]),f.promise):void e.go("docs")},{getDocumentaries:f,getDocumentary:g}}])}(),function(){"use strict";angular.module("learnApp.signup",["ui.router","angular-storage"]).config(["$stateProvider",function(a){a.state("signup",{url:"/signup",controller:"SignUpCtrl",templateUrl:"build/html/signup/signup.html"})}]).controller("SignUpCtrl",["$scope","$http","store","$state","SignUp",function(a,b,c,d,e){a.user={},a.signup=function(){console.log(a.user),e.register(a.user).then(function(a){console.log("-- RESPONSE --"),console.log(a),console.log("user registered."),d.go("login")},function(a){console.log("-- FAIL --"),console.log(a),alert("Error en signup"),d.go(".")})}}]).factory("SignUp",["API_URL","$q","$http",function(a,b,c){var d;return d=function(d){var e=a+"/user/create";console.log("-- REQUEST --");var f=b.defer();return c({method:"POST",url:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:d}).success(function(a){f.resolve(a)}).error(function(a,b){f.reject(a),console.log(a,b)}),f.promise},{register:d}}])}(),function(){"use strict";angular.module("learnApp.news",["ui.router","angular-storage"]).config(["$stateProvider",function(a){a.state("news",{url:"/news",controller:"NewsCtrl",templateUrl:"build/html/news/news.html"})}]).controller("NewsCtrl",["$scope","$http","store","$state",function(a,b,c,d){a.arrNews=[{url:"documentaries",title:"Documentales",image:"documentaries/doc_port",id:"documentaries"}]}])}();